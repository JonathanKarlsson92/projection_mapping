<!DOCTYPE html>
<html>
<head>
<!-- <meta charset="ISO-8859-1"> --> 
<meta charset="utf-8">
<!--
The next two lines bring in the JavaScript files that support rosbridge integration.
-->
<!--<script type="text/javascript" src="http://cdn.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
<script type="text/javascript" src="http://cdn.robotwebtools.org/roslibjs/current/roslib.min.js"></script> -->


<script src="https://cdn.rawgit.com/konvajs/konva/1.7.6/konva.min.js"></script>

<script src="roslibjs/build/roslib.js"></script>
<!--<script src="test.js"></script>-->
<script type="text/javascript" type="text/javascript">
// This function connects to the rosbridge server running on the local computer on port 9090
var rbServer = new ROSLIB.Ros({
    url : 'ws://localhost:9090'
 });

 // This function is called upon the rosbridge connection event
 rbServer.on('connection', function() {
     // Write appropriate message to #feedback div when successfully connected to rosbridge
     var fbDiv = document.getElementById('feedback');
     fbDiv.innerHTML += "<p>Connected to websocket server.</p>";
 });

// This function is called when there is an error attempting to connect to rosbridge
rbServer.on('error', function(error) {
    // Write appropriate message to #feedback div upon error when attempting to connect to rosbridge
    var fbDiv = document.getElementById('feedback');
    fbDiv.innerHTML += "<p>Error connecting to websocket server.</p>";
});

// This function is called when the connection to rosbridge is closed
rbServer.on('close', function() {
    // Write appropriate message to #feedback div upon closing connection to rosbridge
    var fbDiv = document.getElementById('feedback');
    fbDiv.innerHTML += "<p>Connection to websocket server closed.</p>";
 });

var p=[2];

var listener = new ROSLIB.Topic({
		ros : rbServer,
		name : '/ar_projection',	
		messageType : 'geometry_msgs/Pose'
	});

listener.subscribe(function(message) {
	console.log('Received message on ' + listener.name + 'x: ' + message.position.x+ 'y: ' + message.position.y);
	p[0]=message.position.x;
	p[1]=message.position.y;
});


</script>
</head>

<body bgcolor="black">
<div id="feedback"></div> <!--  <---Something important for updating -->
<!-- Script for drawing polygons
	<div id="container"></div>
	<script>
		
	//function draw(){
	    var width = window.innerWidth;
	    var height = window.innerHeight;

	    var stage = new Konva.Stage({
	      container: 'container',
	      width: width,
	      height: height
	    });
		p[0]=0;
		p[1]=0;

	    var layer = new Konva.Layer();

	    var poly = new Konva.Line({
		
	      points: [500+20+p[0], 500+p[1], 700+20+p[0], 500+p[1], 700+p[0], 700+p[1], 500+p[0], 700+p[1]],
	      fill: '#00D2FF',
	      stroke: 'black',
	      strokeWidth: 5,
	      closed : true
	    });
		var hexagon = new Konva.RegularPolygon({
			x: stage.getWidth() / 2,
			y: stage.getHeight() / 2,
			sides: 6,
			radius: 20,
			fill: 'red',
			stroke: 'black',
			strokeWidth: 4
		    });
	    // add the shape to the layer
	    layer.add(hexagon);

	    // add the layer to the stage
	    stage.add(layer);
	

    var anim = new Konva.Animation(function(frame) {
        hexagon.setX(500+p[0]);
	//hexagon.setY(500+p[1]);
    }, layer);

    anim.start();
 	//requestAnimationFrame(draw);
	}
	console.log("		x: " + p[0] + "y: "+p[1]);
	//draw();
</script> -->

<div id="container"></div>
<script>
    p[0]=0;
    p[1]=0;

    var width = window.innerWidth;
    var height = window.innerHeight;

    var stage = new Konva.Stage({
        container: 'container',
        width: width,
        height: height
    });

    var layer = new Konva.Layer();

    var hexagon = new Konva.RegularPolygon({
        x: stage.getWidth() / 2,
        y: stage.getHeight() / 2,
        sides: 6,
        radius: 20,
        fill: 'red',
        stroke: 'black',
        strokeWidth: 4
    });
     var poly = new Konva.Line({
		
	      points: [500+20, 500, 700+20, 500, 700, 700, 500, 700],	//set to the 4 calculated points
	      fill: '#00D2FF',
	      stroke: 'black',
	      strokeWidth: 5,
	      closed : true
	    });
 var poly2 = new Konva.Line({
	
      points: [500+50, 500, 700+50, 500-100, 700, 700-100, 500, 700],	//set to the 4 calculated points
      fill: '#00D2FF',
      stroke: 'black',
      strokeWidth: 5,
      closed : true
    });

    layer.add(hexagon);
    layer.add(poly);
    layer.add(poly2);
    stage.add(layer);

    var amplitude = 100;
    var period = 2000;
    // in ms
    var centerX = stage.getWidth() / 2;

    var anim = new Konva.Animation(function(frame) {
        hexagon.setX(p[0]);
	hexagon.setY(p[1]);
	poly.setX(p[0]);
	poly.setY(p[1]);

	poly2.setX(p[0]-300);
	poly2.setY(p[1]-300);
	//poly.points=[500+20+p[0], 500+p[1], 700+20+p[0], 500+p[1], 700+p[0], 700+p[1], 500+p[0], 700+p[1]];
	/*poly = new Konva.Line({
	      points: [500+20+p[0], 500+p[1], 700+20+p[0], 500+p[1], 700+p[0], 700+p[1], 500+p[0], 700+p[1]],
	      fill: '#00D2FF',
	      stroke: 'green',
	      strokeWidth: 5,
	      closed : true
	    });
	layer.add(poly);
	stage.add(layer);*/
	console.log("		x: " + p[0] + "y: "+p[1]);
	console.log("top left of rhombus"+p[0]+"   "+p[1]);
    }, layer);

    anim.start();
</script>


</body>
</html>
