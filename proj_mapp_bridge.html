<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1"> 
<!--
The next two lines bring in the JavaScript files that support rosbridge integration.
-->
<!--<script type="text/javascript" src="http://cdn.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
<script type="text/javascript" src="http://cdn.robotwebtools.org/roslibjs/current/roslib.min.js"></script> -->

<script src="roslibjs/build/roslib.js"></script>
<!--<script src="test.js"></script>-->
<script type="text/javascript" type="text/javascript">
// This function connects to the rosbridge server running on the local computer on port 9090
var rbServer = new ROSLIB.Ros({
    url : 'ws://localhost:9090'
 });

 // This function is called upon the rosbridge connection event
 rbServer.on('connection', function() {
     // Write appropriate message to #feedback div when successfully connected to rosbridge
     var fbDiv = document.getElementById('feedback');
     fbDiv.innerHTML += "<p>Connected to websocket server.</p>";
 });

// This function is called when there is an error attempting to connect to rosbridge
rbServer.on('error', function(error) {
    // Write appropriate message to #feedback div upon error when attempting to connect to rosbridge
    var fbDiv = document.getElementById('feedback');
    fbDiv.innerHTML += "<p>Error connecting to websocket server.</p>";
});

// This function is called when the connection to rosbridge is closed
rbServer.on('close', function() {
    // Write appropriate message to #feedback div upon closing connection to rosbridge
    var fbDiv = document.getElementById('feedback');
    fbDiv.innerHTML += "<p>Connection to websocket server closed.</p>";
 });

var p=0;

var listener = new ROSLIB.Topic({
		ros : rbServer,
		name : '/ar_projection',
		messageType : 'std_msgs/String'
	});

listener.subscribe(function(message) {
	console.log('Received message on ' + listener.name + ': ' + message.data);
	p=message.data;
});


</script>
</head>

<body bgcolor="black">
<div id="feedback"></div> <!--  <---Something important for updating -->
<canvas id="canvas" ></canvas>
    <script>
	//make a black background
        var can = document.getElementById('canvas');
	var ctx = can.getContext('2d');
	var circ = can.getContext('2d');
        can.height = 1000; can.width = 1920;
	//can.fillStyle = "black";
       

	
        
        var x = 0, y = 0;
        function draw() {
	    //clear old drawing
            ctx.clearRect(0, 0, 1000, 1920);
	    

	    //message p recieved from the ros topic
            x = p; 
	    y = p;
	    console.log('var value : ' + p);
            //ctx.fillStyle = "rgba(0,255,0,0.5)"; //green color for rhombus
	    //circ.fillStyle = "rgba(0,255,0,0.5)"; //circle

	    //One box
	    ctx.lineWidth=10;
            
	    ctx.beginPath();
	    ctx.moveTo(x,y); //top left
	    //var xn=x-20;
	    ctx.lineTo(x+50,y); //top right
	    ctx.strokeStyle = "rgba(0,200,0,1)";
	    ctx.stroke();
	    //ctx.closePath();

            /*ctx.beginPath();
	    ctx.moveTo(x,y);
	    ctx.lineTo(100,0); //bottom right
   	    ctx.strokeStyle = "rgba(0,200,0,1)";
	    ctx.stroke();
	    ctx.closePath();

            ctx.beginPath();
	    ctx.moveTo(0,0);
	    ctx.lineTo(0,100); //bottom left
   	    ctx.strokeStyle = "rgba(0,200,0,1)";
	    ctx.stroke();
	    ctx.closePath();

            ctx.beginPath();
	    ctx.lineTo(0,0); 
	    ctx.moveTo(-100,0); //top left
   	    ctx.strokeStyle = "rgba(0,200,0,1)";
	    ctx.stroke();
	    ctx.closePath();*/

	   

            //ctx.fillStyle = "rgba(0,0,0,0.4)";
            //ctx.fillRect(0, 0, can.width, can.height);
	 
            
	     // a filled circle
	    circ.beginPath();
	    circ.moveTo(50,50);
            circ.arc(x, y, p, 0, 2 * Math.PI);
            circ.fillStyle = 'rgba(250,0,0,0.4)';
            circ.fill();

            //circ.fillStyle = "rgba(0,0,0,0.4)";
            //circ.fillRect(0, 0, can.width, can.height);

            requestAnimationFrame(draw);
	   
        }
        draw();

    </script>
   
</body>
</html>
